!function(t){function e(o){if(i[o])return i[o].exports;var s=i[o]={exports:{},id:o,loaded:!1};return t[o].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";var o=i(1),s=new o.NavigationController;$(document).ready(function(){location.hash="#start",Route.listen()}),Route.map("#top100").to(function(){s.goToPage("top100")}),Route.map("#start").to(function(){s.goToPage("start")}),Route.map("#play").to(function(){s.goToPage("play")})},function(t,e,i){"use strict";var o=i(2),s=function(){function t(){this._allPages={};var t=this._allPages;t.start=function(){return new n},t.top100=function(){return new r},t.play=function(){return new o.PlayPageController}}return t.prototype.goToPage=function(t){null!=this._latestPage&&this._latestPage.leave(),$("#main-content").html(""),this._latestPage=this._allPages[t](),this._latestPage.enter()},t}();e.NavigationController=s;var n=function(){function t(){}return t.prototype.enter=function(){$("#main-content").html($("#start-page-template").html())},t.prototype.leave=function(){},t}(),r=function(){function t(){}return t.prototype.enter=function(){$("#main-content").html($("#top100-page-template").html());var t=$("#main-content > .top-100-page");t.find(".top-100-preloader").toggle(!1),t.find(".top-100-content").toggle(!1),t.find(".top-100-preloader").fadeIn({duration:2e3});var e="api/well?offset=0&limit=20";this._loadRating(e)},t.prototype.leave=function(){},t.prototype._loadRating=function(t){var e=this;$.getJSON(t).done(function(t){return e.fillTop100(t)}).fail(function(){return Raven.captureMessage("Ошибка загрузки топ 100",{})})},t.prototype.fillTop100=function(t){for(var e=this,i="",o=0;o<t.data.length;++o)0!==o&&(i+=","),i+=t.data[o].id;VK.api("users.get",{user_ids:i,fields:"photo_50,city,verified"},function(i){var o={};if(null!=i.response)for(var s=0;s<i.response.length;++s)o[i.response[s].id]=i.response[s];var n,r,a=$(".top-100-content tbody");for(n=0;n<t.data.length;++n){r=n+t.offset,0===a.children().eq(r).length&&a.append('<tr><td></td><td><div class="round-image"><a target="_blank"><img></img></a><div></td><td></td><td></td></tr>');var h=a.children().eq(r).find("td");h.eq(0).text(r+1);var u=o[t.data[n].id],l=null!=u?u.first_name+" "+u.last_name:t.data[n].userName;null!=u&&(h.eq(1).find("img").attr("src",u.photo_50),h.eq(1).find("a").attr("href","//vk.com/id"+u.id)),h.eq(2).text(l),h.eq(3).text(t.data[n].result)}var c=$(".top-100-more-button");c.unbind("click"),null!==t.next?(c.removeClass("hidden"),c.click(function(){return e._loadRating(t.next)})):c.addClass("hidden"),$(".top-100-preloader").stop().toggle(!1),$(".top-100-content").fadeIn(200)})},t}()},function(t,e,i){"use strict";var o,s=i(3),n=i(5),r=i(6),a=i(4);!function(t){t[t.Run=0]="Run",t[t.Pause=1]="Pause",t[t.GameOver=2]="GameOver"}(o||(o={}));var h=function(){function t(){}return t.prototype.enter=function(){var t=this;$("#main-content").html($("#play-page-template").html()),this._root=$("#main-content .play-page");var e=this._root.find(".play-again-button"),i=this._root.find(".play-continue-button");this._cancel_button=this._root.find(".play-cancel-button"),this._pause_button=this._root.find(".play-pause-button"),this._back_button=this._root.find(".play-back-button"),this._game_over_pane=this._root.find(".game-over"),this._game_pause_pane=this._root.find(".game-pause"),this._success_icon=this._root.find(".well-game-scope-success"),this._fail_icon=this._root.find(".well-game-scope-fail"),this._sync_icon=this._root.find(".well-game-scope-sync"),e.click(function(){return t._start()}),this._cancel_button.click(function(){return t._cancel()}),this._pause_button.click(function(){return t._to_pause()}),i.click(function(){return t._continue()}),this._handlerEventListener=function(e){return t._processKeyboardEvent(e)},document.addEventListener("keydown",this._handlerEventListener),this._start()},t.prototype.leave=function(){document.removeEventListener("keydown",this._handlerEventListener)},t.prototype._processKeyboardEvent=function(t){return 32!=t.keyCode&&37!=t.keyCode&&38!=t.keyCode&&39!=t.keyCode&&40!=t.keyCode||t.preventDefault(),this._gameState==o.Run?void(t.keyCode==a.KeyCode.KEY_P&&this._to_pause()):this._gameState==o.Pause?void(t.keyCode==a.KeyCode.KEY_P&&this._continue()):this._gameState==o.GameOver?void(t.keyCode!=a.KeyCode.ENTER&&t.keyCode!=a.KeyCode.SPACE||this._start()):void 0},t.prototype._to_pause=function(){this._keyboardInput.disable(),this._mouseInput.disable(),this._wellController.Pause(),this._set_game_state(o.Pause)},t.prototype._cancel=function(){this._keyboardInput.disable(),this._mouseInput.disable(),this._wellController.stopGame(),this._gameOverCallback()},t.prototype._start=function(){var t=this;this._set_game_state(o.Run),this._showScope(0),this._wellController=new r.Controller($("canvas")[0],function(e){return t._showScope(e)},function(){return t._gameOverCallback()}),this._keyboardInput=new s.KeyboardInput(this._wellController),this._mouseInput=new n.MouseInput(this._wellController,$("canvas")[0]),this._wellController.startGame()},t.prototype._gameOverCallback=function(){this._set_game_state(o.GameOver),this._sendResult()},t.prototype._continue=function(){this._set_game_state(o.Run),this._keyboardInput.enable(),this._mouseInput.enable(),this._wellController.Resume()},t.prototype._set_game_state=function(t){this._gameState=t,this._cancel_button.toggle(t!=o.GameOver),this._game_over_pane.toggle(t===o.GameOver),this._back_button.toggle(t===o.GameOver),this._game_pause_pane.toggle(t===o.Pause),this._pause_button.toggle(t===o.Run),t===o.GameOver&&(this._success_icon.hide(),this._fail_icon.hide(),this._sync_icon.show())},t.prototype._showScope=function(t){this._root.find(".well-game-scope").text(t)},t.prototype._sendResult=function(){var t=this._success_icon,e=this._sync_icon;t.fadeIn({duration:500}),e.fadeOut({duration:500})},t.PreventDefaults=[a.KeyCode.SPACE,a.KeyCode.LEFT_ARROW,a.KeyCode.RIGHT_ARROW,a.KeyCode.UP_ARROW,a.KeyCode.DOWN_ARROW],t}();e.PlayPageController=h},function(t,e,i){"use strict";var o=i(4),s=function(){function t(t){var e=this;this.mayDownBegan=!1,this.wellController=t,this.handlerEventListener=function(t){return e.ProcessKeyboardEvent(t)},this.enable()}return t.prototype.enable=function(){if(this.enabled)throw new Error("Уже включен");document.addEventListener("keydown",this.handlerEventListener)},t.prototype.disable=function(){if(this.enabled===!1)throw new Error("Уже выключен");document.removeEventListener("keydown",this.handlerEventListener)},t.prototype.ProcessKeyboardEvent=function(t){t.keyCode!==o.KeyCode.KEY_S&&t.keyCode!==o.KeyCode.DOWN_ARROW||(t.repeat||(this.mayDownBegan=!0),this.mayDownBegan&&(this.mayDownBegan=this.wellController.down())),t.keyCode!==o.KeyCode.KEY_D&&t.keyCode!==o.KeyCode.RIGHT_ARROW||this.wellController.moveRight(),t.keyCode!==o.KeyCode.KEY_A&&t.keyCode!==o.KeyCode.LEFT_ARROW||this.wellController.moveLeft(),t.repeat||(t.keyCode!==o.KeyCode.KEY_W&&t.keyCode!==o.KeyCode.UP_ARROW||this.wellController.rotate(),t.keyCode===o.KeyCode.SPACE&&this.wellController.pullDown())},t}();e.KeyboardInput=s},function(t,e){"use strict";!function(t){t[t.BACKSPACE=8]="BACKSPACE",t[t.TAB=9]="TAB",t[t.ENTER=13]="ENTER",t[t.SHIFT=16]="SHIFT",t[t.CTRL=17]="CTRL",t[t.ALT=18]="ALT",t[t.PAUSE=19]="PAUSE",t[t.CAPS_LOCK=20]="CAPS_LOCK",t[t.ESCAPE=27]="ESCAPE",t[t.SPACE=32]="SPACE",t[t.PAGE_UP=33]="PAGE_UP",t[t.PAGE_DOWN=34]="PAGE_DOWN",t[t.END=35]="END",t[t.HOME=36]="HOME",t[t.LEFT_ARROW=37]="LEFT_ARROW",t[t.UP_ARROW=38]="UP_ARROW",t[t.RIGHT_ARROW=39]="RIGHT_ARROW",t[t.DOWN_ARROW=40]="DOWN_ARROW",t[t.INSERT=45]="INSERT",t[t.DELETE=46]="DELETE",t[t.KEY_0=48]="KEY_0",t[t.KEY_1=49]="KEY_1",t[t.KEY_2=50]="KEY_2",t[t.KEY_3=51]="KEY_3",t[t.KEY_4=52]="KEY_4",t[t.KEY_5=53]="KEY_5",t[t.KEY_6=54]="KEY_6",t[t.KEY_7=55]="KEY_7",t[t.KEY_8=56]="KEY_8",t[t.KEY_9=57]="KEY_9",t[t.KEY_A=65]="KEY_A",t[t.KEY_B=66]="KEY_B",t[t.KEY_C=67]="KEY_C",t[t.KEY_D=68]="KEY_D",t[t.KEY_E=69]="KEY_E",t[t.KEY_F=70]="KEY_F",t[t.KEY_G=71]="KEY_G",t[t.KEY_H=72]="KEY_H",t[t.KEY_I=73]="KEY_I",t[t.KEY_J=74]="KEY_J",t[t.KEY_K=75]="KEY_K",t[t.KEY_L=76]="KEY_L",t[t.KEY_M=77]="KEY_M",t[t.KEY_N=78]="KEY_N",t[t.KEY_O=79]="KEY_O",t[t.KEY_P=80]="KEY_P",t[t.KEY_Q=81]="KEY_Q",t[t.KEY_R=82]="KEY_R",t[t.KEY_S=83]="KEY_S",t[t.KEY_T=84]="KEY_T",t[t.KEY_U=85]="KEY_U",t[t.KEY_V=86]="KEY_V",t[t.KEY_W=87]="KEY_W",t[t.KEY_X=88]="KEY_X",t[t.KEY_Y=89]="KEY_Y",t[t.KEY_Z=90]="KEY_Z",t[t.LEFT_META=91]="LEFT_META",t[t.RIGHT_META=92]="RIGHT_META",t[t.SELECT=93]="SELECT",t[t.NUMPAD_0=96]="NUMPAD_0",t[t.NUMPAD_1=97]="NUMPAD_1",t[t.NUMPAD_2=98]="NUMPAD_2",t[t.NUMPAD_3=99]="NUMPAD_3",t[t.NUMPAD_4=100]="NUMPAD_4",t[t.NUMPAD_5=101]="NUMPAD_5",t[t.NUMPAD_6=102]="NUMPAD_6",t[t.NUMPAD_7=103]="NUMPAD_7",t[t.NUMPAD_8=104]="NUMPAD_8",t[t.NUMPAD_9=105]="NUMPAD_9",t[t.MULTIPLY=106]="MULTIPLY",t[t.ADD=107]="ADD",t[t.SUBTRACT=109]="SUBTRACT",t[t.DECIMAL=110]="DECIMAL",t[t.DIVIDE=111]="DIVIDE",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NUM_LOCK=144]="NUM_LOCK",t[t.SCROLL_LOCK=145]="SCROLL_LOCK",t[t.SEMICOLON=186]="SEMICOLON",t[t.EQUALS=187]="EQUALS",t[t.COMMA=188]="COMMA",t[t.DASH=189]="DASH",t[t.PERIOD=190]="PERIOD",t[t.FORWARD_SLASH=191]="FORWARD_SLASH",t[t.GRAVE_ACCENT=192]="GRAVE_ACCENT",t[t.OPEN_BRACKET=219]="OPEN_BRACKET",t[t.BACK_SLASH=220]="BACK_SLASH",t[t.CLOSE_BRACKET=221]="CLOSE_BRACKET",t[t.SINGLE_QUOTE=222]="SINGLE_QUOTE"}(e.KeyCode||(e.KeyCode={}));e.KeyCode},function(t,e){"use strict";var i=function(){function t(t,e){var i=this;this.mouseMoveListener=function(t){return i.ProcessMouseMoveEvent(t)},this.mouseDownListener=function(t){return i.ProcessMouseDownEvent(t)},this.mouseUpListener=function(t){return i.ProcessMouseUpEvent(t)},this.xMovement=0,this.yMovement=0,this.state=o.None,this.wellController=t,this.canvas=e,this.enable()}return t.prototype.enable=function(){if(this.enabled)throw new Error("Уже включен");this.canvas.addEventListener("mousemove",this.mouseMoveListener),this.canvas.addEventListener("mousedown",this.mouseDownListener),window.addEventListener("mouseup",this.mouseUpListener),$("body").addClass("unsectable"),this.canvas.onselectstart=function(){return!1}},t.prototype.disable=function(){if(this.enabled===!1)throw new Error("Уже выключен");this.canvas.removeEventListener("keydown",this.mouseMoveListener),this.canvas.removeEventListener("mousedown",this.mouseDownListener),window.removeEventListener("mouseup",this.mouseUpListener),$("body").removeClass("unsectable")},t.prototype.ProcessMouseMoveEvent=function(t){if(this.state!==o.None){this.xMovement+=t.movementX,t.movementY>0&&(this.yMovement+=t.movementY);for(var e=15;this.xMovement>e||this.xMovement<-e;)this.yMovement=0,this.xMovement>0&&(this.xMovement-=e,this.wellController.moveLeft()),t.movementX<0&&(this.xMovement+=e,this.wellController.moveRight());for(var i=5;this.state===o.Click&&this.yMovement>i;){this.xMovement=0,this.yMovement-=i;var s=this.wellController.down();s===!1&&(this.state=o.NoMoveY)}}},t.prototype.ProcessMouseDownEvent=function(t){this.state=o.Click},t.prototype.ProcessMouseUpEvent=function(t){this.state!==o.None&&(0===this.xMovement&&0===this.yMovement&&this.wellController.rotate(),this.state=o.None,this.xMovement=0,this.yMovement=0)},t}();e.MouseInput=i;var o;!function(t){t[t.None=0]="None",t[t.Click=1]="Click",t[t.NoMoveY=2]="NoMoveY"}(o||(o={}))},function(t,e,i){"use strict";var o=i(7),s=i(8),n=i(9),r=function(){function t(t,e,i){var r=this;this.layers=15,this.numbers=15,this.scope=new h,this.loop=new a,this.stepTime=new u(1e3),this.model=new s.WellTetris(this.numbers,this.layers),this.render=null,this.render=new n.CanvasRender(this.numbers,this.layers,this.model,t),this.scopeCallback=e,this.gameOverCallback=i,this.stepTimer=new o.StepTimer(function(){return r.gameStep()})}return t.prototype.moveLeft=function(){this.model.isGameOver()||this.model.moveLeft()&&this.render.draw()},t.prototype.moveRight=function(){this.model.isGameOver()||this.model.moveRight()&&this.render.draw()},t.prototype.rotate=function(){this.model.isGameOver()||(this.model.rotateRight(),this.render.draw())},t.prototype.down=function(){return!this.model.isGameOver()&&(this.stepTimer.step(0),this.model.canMoveDown())},t.prototype.pullDown=function(){for(;this.model.canMoveDown();)this.model.moveDown();this.gameStep()},t.prototype.gameStep=function(){if(!this.model.isGameOver()){if(this.loop.start(),this.model.canMoveDown()){this.model.moveDown(),this.render.draw();var t=this.loop.getDelay(this.stepTime.timeout);return void this.stepTimer.step(t)}if(this.model.figureInside()){this.model.applyFigure();var e=this.model.removeFullLayer();this.updateScope(e),this.updateTimer(e);var i=this.model.newFigure();if(i){this.model.flip(),this.render.draw();var t=this.loop.getDelay(this.stepTime.timeout);return void this.stepTimer.step(t)}}this.render.draw(),this.model.stopGame(),this.gameOverCallback()}},t.prototype.updateScope=function(t){this.scope.update(t),this.scopeCallback(this.scope.total)},t.prototype.updateTimer=function(t){this.stepTime.update(t)},t.prototype.startGame=function(){this.model.isGameOver()||(this.render.draw(),this.stepTimer.step(0))},t.prototype.stopGame=function(){this.model.stopGame()},t.prototype.getResult=function(){return{scope:this.scope.total,signature:this.model.getHistory()}},t.prototype.Pause=function(){this.stepTimer.stop()},t.prototype.Resume=function(){this.stepTimer.restart()},t}();e.Controller=r;var a=function(){function t(){}return t.prototype.start=function(){this.startTime=(new Date).getTime()},t.prototype.getDelay=function(t){var e=(new Date).getTime();return Math.max(0,t-(e-this.startTime))},t}(),h=function(){function t(){this._total=0}return Object.defineProperty(t.prototype,"total",{get:function(){return this._total},enumerable:!0,configurable:!0}),t.prototype.update=function(t){1===t&&(this._total+=100),2===t&&(this._total+=300),3===t&&(this._total+=700),4===t&&(this._total+=1500)},t}(),u=function(){function t(t){this._removed=0,this._timeout=t}return Object.defineProperty(t.prototype,"timeout",{get:function(){return this._timeout},enumerable:!0,configurable:!0}),t.prototype.update=function(t){t>0&&(this._removed++,this._timeout=300+Math.round(600/Math.pow(1.05,this._removed)))},t}()},function(t,e){"use strict";var i=function(){function t(t){this._latestStep=0,this._latestTimeout=0,this._callback=t}return t.prototype.step=function(t){var e=this;this._latestStep++,this._latestTimeout=t,setTimeout(function(t){return e._timeoutCallback(t)},t,this._latestStep)},t.prototype.restart=function(){this.step(this._latestTimeout)},t.prototype.stop=function(){this._latestStep++},t.prototype._timeoutCallback=function(t){t===this._latestStep&&this._callback()},t}();e.StepTimer=i},function(t,e){"use strict";var i=function(){function t(t,e){this.gameOver=!1,this.well=[],this.figureCollections=new n,this._history=new r,this.size=t,this.layers=e;for(var i=0;i<e;i++){for(var s=[],a=0;a<t;++a)s.push(null);this.well.push(s)}this.well[Math.floor(e/2)][Math.floor(Math.random()*t)]=o.S,this.followingFigure=this.figureCollections.getRandomFigure(),this.figure=this.figureCollections.getRandomFigure(),this.figurePos={layer:e,position:0}}return t.prototype._checkFigure=function(t,e){return t-=this.figurePos.layer,e=(e-this.figurePos.position+this.size)%this.size,t>=0&&e>=0&&t<4&&e<4&&this.figure.bricks[t][e]},t.prototype.getBrickType=function(t,e){return t<0||t>=this.layers?null:(e=(e%this.size+this.size)%this.size,this._checkFigure(t,e)?this.figure.type:this.well[t][e])},t.prototype._figureCollision=function(){for(var t=this.figurePos.layer,e=this.figurePos.position,i=0;i<4;i++)for(var o=0;o<4;++o)if(this.figure.bricks[i][o]){if(t+i<0)return!0;if(t+i<this.layers&&null!==this.well[t+i][(e+o+this.size)%this.size])return!0}return!1},t.prototype.applyFigure=function(){if(!this.gameOver)for(var t=this.figurePos.layer,e=this.figurePos.position,i=0;i<4;i++)for(var o=0;o<4;++o)this.figure.bricks[i][o]&&t+i>=0&&t+i<this.layers&&(this.well[t+i][(e+o+this.size)%this.size]=this.figure.type)},t.prototype.figureInside=function(){if(this.gameOver)return!0;for(var t=this.figurePos.layer,e=0;e<4;e++)for(var i=0;i<4;++i)if(0!=this.figure.bricks[e][i]&&t+e>=this.layers)return!1;return!0},t.prototype.newFigure=function(){return!this.gameOver&&(this.figure=this.followingFigure,this.followingFigure=this.figureCollections.getRandomFigure(),this.figurePos.layer=this.layers-1,this.gameOver=this._figureCollision(),this.gameOver===!1)},t.prototype.flip=function(){if(this.gameOver)return!1;for(var t=0;t<=this.layers/2;++t){var e=this.well[t];this.well[t]=this.well[this.layers-1-t],this.well[this.layers-1-t]=e}},t.prototype.moveLeft=function(){if(!this.gameOver){var t=this.figurePos.position;return this.figurePos.position=(this.figurePos.position-1+this.size)%this.size,!this._figureCollision()||(this.figurePos.position=t,!1)}},t.prototype.moveRight=function(){if(!this.gameOver){var t=this.figurePos.position;return this.figurePos.position=(this.figurePos.position+1)%this.size,!this._figureCollision()||(this.figurePos.position=t,!1)}},t.prototype.moveDown=function(){this.gameOver||this.figurePos.layer--},t.prototype.canMoveDown=function(){if(!this.gameOver){this.figurePos.layer--;var t=this._figureCollision()===!1;return this.figurePos.layer++,t}},t.prototype.removeFullLayer=function(){if(this.gameOver)return 0;for(var t=0,e=this.layers-1;e>=0;e--){var i,o=!0;for(i=0;i<this.size;++i)o=o&&null!==this.well[e][i];if(o){for(i=0;i<this.size;++i)this.well[e][i]=null;for(var s=this.well[e],n=e;n<this.layers-1;n++)this.well[n]=this.well[n+1];this.well[this.layers-1]=s,t++}}return this._history.Add(t),t},t.prototype.isGameOver=function(){return this.gameOver},t.prototype.stopGame=function(){this.gameOver=!0},t.prototype.rotateRight=function(){if(this.gameOver)return!1;this.figure.next();var t=this._figureCollision();return t&&this.figure.prev(),!t},t.prototype.getHistory=function(){return this._history.Dumb()},t}();e.WellTetris=i,function(t){t[t.S=0]="S",t[t.Z=1]="Z",t[t.T=2]="T",t[t.I=3]="I",t[t.O=4]="O",t[t.L=5]="L",t[t.J=6]="J"}(e.FigureType||(e.FigureType={}));var o=e.FigureType,s=function(){function t(t,e){this._figure=t,this._frameNo=0,this._type=e}return Object.defineProperty(t.prototype,"bricks",{get:function(){return this._figure[this._frameNo]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),t.prototype.next=function(){this._frameNo=(this._frameNo+1)%this._figure.length},t.prototype.prev=function(){this._frameNo=(this._frameNo+this._figure.length-1)%this._figure.length},t}(),n=function(){function t(){this._figures=[{type:o.S,bricks:[[[0,1,1,0],[0,0,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]]]},{type:o.Z,bricks:[[[0,0,1,1],[0,1,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]]]},{type:o.T,bricks:[[[0,1,1,1],[0,0,1,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,0],[0,1,0,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]]]},{type:o.I,bricks:[[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[1,1,1,1],[0,0,0,0],[0,0,0,0],[0,0,0,0]]]},{type:o.O,bricks:[[[0,1,1,0],[0,1,1,0],[0,0,0,0],[0,0,0,0]]]},{type:o.L,bricks:[[[0,1,1,1],[0,0,0,1],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,1,0,0],[0,1,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,1,1,0],[0,0,0,0]]]},{type:o.J,bricks:[[[0,1,1,1],[0,1,0,0],[0,0,0,0],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,1],[0,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,0,1,0],[0,0,1,0],[0,0,0,0]]]}]}return t.prototype.getRandomFigure=function(){var t=this._figures[Math.floor(Math.random()*this._figures.length)];return new s(t.bricks,t.type)},t}(),r=function(){function t(){this.buffer=[0],this.codes=[{code:1,length:2},{code:3,length:4},{code:7,length:4},{code:11,length:4},{code:15,length:4}],this.offset=0,this.encode="qwertyuioplkjhgfdsazxcvbnm,./'][{}:\">?!@#$%^&*()_+=-0987654321~`"}return t.prototype.Add=function(t){var e=this.buffer.pop(),i=this.codes[t],o=6-this.offset,s=(1<<o)-1;e|=(i.code&s)<<this.offset,this.buffer.push(e),this.offset+=i.length,this.offset>=6&&(this.offset%=6,e=i.code>>o,this.buffer.push(e))},t.prototype.Dumb=function(){for(var t=this.encode.length,e=Math.floor(Math.random()*t),i=this.encode[e],o=0;o<this.buffer.length;++o)e=(e+31)%t,i+=this.encode[(this.buffer[o]+e)%t];return i},t}()},function(t,e,i){"use strict";var o=i(8),s=function(){function t(t,e,i,o){this.rotationX=-2*Math.PI/5,this.brickColors={S:["#74E44D","#55BD00"],Z:["#F76A53","#C03D28"],T:["#DB8BBC","#B26795"],I:["#FEEB4D","#E9D700"],O:["#4DD6CD","#00A8A0"],J:["#7373E2","#5B5BC1"],L:["#E3B372","#C3975A"]},this.innerRadius=4,this.outerRadius=5,this.layerSize=2,this.canvas=o,this.wellTetris=i,this.size=t,this.layers=e}return t.prototype.draw=function(){var t=this.canvas,e=this.wellTetris,i=this.size,o=t.getContext("2d"),s=t.width,n=t.height;o.clearRect(0,0,s,n),o.lineJoin="bevel",o.lineWidth=2,o.strokeStyle="#000",this.DrawNextFigure(e.followingFigure,s,o);var r=17,a=Math.PI/2;o.lineWidth=1.5,o.setTransform(1,0,0,Math.cos(this.rotationX),s/2,n-40),o.beginPath(),o.arc(0,0,17*this.outerRadius,0,2*Math.PI);for(var h=0,u=[0,5,-5];h<u.length;h++){var l=u[h],c=(l+this.wellTetris.figurePos.position)/i*2*Math.PI+a,p={x:Math.cos(c)*r,y:Math.sin(c)*r};o.moveTo(p.x*this.innerRadius,p.y*this.innerRadius),o.lineTo(p.x*this.outerRadius,p.y*this.outerRadius)}o.stroke(),o.lineWidth=2,o.strokeStyle="#000";for(var f=[7,6,8,5,9,4,10],d=0,_=f;d<_.length;d++)for(var l=_[d],y=0;y<this.layers;++y)this.drawBrick(l,y,o);var m=this.layerSize*r/Math.cos(this.rotationX)*Math.sin(this.rotationX);o.fillStyle="rgba(255, 255, 255, 0.8)",o.beginPath(),o.moveTo(this.innerRadius*r,0),o.arc(0,0,this.innerRadius*r,0,Math.PI),o.arc(0,m*this.layers,this.innerRadius*r,Math.PI,0),o.lineTo(this.innerRadius*r,0),o.fill(),o.strokeStyle="#000",o.lineWidth=1,o.beginPath(),o.arc(0,m*this.layers,this.innerRadius*r,0,2*Math.PI);for(var v=0;v<this.layers;++v)o.moveTo(this.innerRadius*r,m*v),o.arc(0,m*v,this.innerRadius*r,0,Math.PI,!1);for(var g=0,E=[0,1,2,3,-1,-2,-3];g<E.length;g++){var l=E[g],c=l/this.size*2*Math.PI+a,p={x:Math.cos(c)*r*this.innerRadius,y:Math.sin(c)*r*this.innerRadius};o.moveTo(p.x,p.y),o.lineTo(p.x,p.y+m*this.layers)}o.moveTo(this.innerRadius*r,0),o.lineTo(this.innerRadius*r,m*this.layers),o.moveTo(-this.innerRadius*r,0),o.lineTo(-this.innerRadius*r,m*this.layers),o.stroke(),o.lineWidth=1.5,o.strokeStyle="#000";for(var R=[3,11,2,12,1,13,0,14],C=0,P=R;C<P.length;C++)for(var l=P[C],y=0;y<this.layers;++y)this.drawBrick(l,y,o);o.setTransform(1,0,0,1,0,0)},t.prototype.drawBrick=function(t,e,i){var s=17,n=Math.PI/2,r=this.layerSize*s/Math.cos(this.rotationX)*Math.sin(this.rotationX),a=t/this.size*2*Math.PI+n,h=(t+1)/this.size*2*Math.PI+n,u={x:Math.cos(a)*s,y:Math.sin(a)*s},l={x:Math.cos(h)*s,y:Math.sin(h)*s},c=r*e,p=r*(e+1),f=this.wellTetris.figurePos.position-t+1,d=this.wellTetris.getBrickType(e,f);if(null!=d){var _=this.brickColors[o.FigureType[d]][0],y=this.brickColors[o.FigureType[d]][1];i.fillStyle=_,u.x<=0&&null===this.wellTetris.getBrickType(e,f+1)&&(i.beginPath(),i.moveTo(u.x*this.innerRadius,u.y*this.innerRadius+c),i.lineTo(u.x*this.innerRadius,u.y*this.innerRadius+p),i.lineTo(u.x*this.outerRadius,u.y*this.outerRadius+p),i.lineTo(u.x*this.outerRadius,u.y*this.outerRadius+c),i.fill(),i.closePath(),i.stroke()),l.x>=0&&null===this.wellTetris.getBrickType(e,f-1)&&(i.beginPath(),i.moveTo(l.x*this.innerRadius,l.y*this.innerRadius+c),i.lineTo(l.x*this.innerRadius,l.y*this.innerRadius+p),i.lineTo(l.x*this.outerRadius,l.y*this.outerRadius+p),i.lineTo(l.x*this.outerRadius,l.y*this.outerRadius+c),i.fill(),i.closePath(),i.stroke()),(u.y+l.y)/2>=0&&(i.beginPath(),i.moveTo(u.x*this.outerRadius,u.y*this.outerRadius+c),i.arc(0,c,this.outerRadius*s,a,h),i.arc(0,p,this.outerRadius*s,h,a,!0),i.lineTo(u.x*this.outerRadius,u.y*this.outerRadius+c),i.fill(),i.stroke()),(u.y+l.y)/2<0&&(i.fillStyle=y,i.beginPath(),i.moveTo(u.x*this.innerRadius,u.y*this.innerRadius+c),i.arc(0,c,this.innerRadius*s,a,h),i.lineTo(l.x*this.innerRadius,l.y*this.innerRadius+p),i.arc(0,p,this.innerRadius*s,h,a,!0),i.lineTo(u.x*this.innerRadius,u.y*this.innerRadius+c),i.fill(),i.stroke()),null===this.wellTetris.getBrickType(e+1,f)&&(i.fillStyle=_,i.beginPath(),i.moveTo(u.x*this.innerRadius,u.y*this.innerRadius+p),i.arc(0,p,this.innerRadius*s,a,h),i.lineTo(l.x*this.outerRadius,l.y*this.outerRadius+p),i.arc(0,p,this.outerRadius*s,h,a,!0),i.lineTo(u.x*this.innerRadius,u.y*this.innerRadius+p),i.fill(),i.stroke())}},t.prototype.DrawNextFigure=function(t,e,i){i.fillStyle=this.brickColors[o.FigureType[t.type]][0];for(var s=0;s<4;s++)for(var n=0;n<4;++n)t.bricks[n][s]&&(i.fillRect(e-130+30*s,10+30*(3-n),30,30),i.strokeRect(e-130+30*s,10+30*(3-n),30,30))},t.prototype.DrawPath=function(t,e,i){for(var o=0;o<t.length;++o)t[o].applyMatrix4(e);i.beginPath(),i.moveTo(t[0].x,t[0].y);for(var o=1;o<t.length;++o)i.lineTo(t[o].x,t[o].y);i.stroke()},t}();e.CanvasRender=s}]);