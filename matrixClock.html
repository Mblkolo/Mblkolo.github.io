<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

<meta name="robots" content="noindex">
  <title>Matrix clock</title>

<style>
canvas {
    position: absolute;
    width: 100%;
    height: 100%;
    top:0;
    left:0;
    background-color: #555;
}
</style>
</head>
<body>
  <canvas id="matrixCanvas">У вас не работает canvas</canvas>
<script>
var size = 15;

var example = document.getElementById("matrixCanvas");
var ctx = example.getContext('2d');

var sample = document.createElement('canvas');
var sampleCtx = sample.getContext('2d');

function getTime()
{
  var currentdate = new Date(); 
  var hours = (currentdate.getHours()).toString();
  var minutes = (currentdate.getMinutes()).toString();
  if(hours.length === 1)
    hours = " " + hours;
  if(minutes.length === 1)
    minutes = " " + minutes;
  
  var datetime = hours + ":"  + minutes;
  sampleCtx.fillText(datetime, sample.width/2, sample.height/2); 
}

var latestTime = "";
function refreshSample(forse)
{
  var currentTime = getTime();
  if(!forse && latestTime === currentTime)
    return;
  
  latestTime = currentTime;
  sample.width = Math.ceil(example.width / size);
  sample.height = Math.ceil(example.height / size);
  
  sampleCtx.fillStyle = "black";
  sampleCtx.fillRect(0, 0, sample.width, sample.height);
  sampleCtx.font = Math.floor(sample.height/2) + "px Tahoma";
  sampleCtx.fillStyle = "white";
  sampleCtx.textAlign = "center";
  sampleCtx.textBaseline = 'middle';
  //sampleCtx.fillText(currentTime, sample.width/2, sample.height/2); 
}

var items = {};

setInterval(function()
{
    if(example.width != window.innerWidth || example.height != window.innerHeight)
    {
        example.width = window.innerWidth;
        example.height = window.innerHeight;
                    
        ctx.fillStyle = "green";
        ctx.fillRect(0, 0, example.width, example.height);

        refreshSample(true);  
    }
    else
        refreshSample();  
  
    ctx.font = size+ "px Arail";
    ctx.fillStyle = 'rgba(0,0,0, 0.05)';
    ctx.fillRect(0, 0, example.width, example.height);
    
    var sampleData = sampleCtx.getImageData(0, 0, sample.width, sample.height);
    for(var i=0; i<Math.ceil(example.width/size); i++)
    {
        if(typeof items[i] === 'undefined')
            items[i] = Math.floor(Math.random()*example.height/size);

        var d = sampleData.data;
        var base = (items[i] * sampleData.width + i) * 4;
        if(0.3*d[base+ 0] + 0.59*d[base + 1] + 0.11*d[base + 2] >= 128)
          ctx.fillStyle = '#19ff19';//"#ffd700";
        else
          ctx.fillStyle = "green";
                
        var symbol = Math.floor(Math.random() * (0x4DB5 - 0x3400)) + 0x3400;
        ctx.fillText(String.fromCharCode(symbol), i*size, items[i]*size);
        items[i]++;
        
        if(items[i] > Math.ceil(example.height/size - Math.random() * 6 + 3))
            items[i] = 0;
    }
  //var imgData = sampleCtx.getImageData(0, 0, sample.width, sample.height);
  //ctx.putImageData(imgData, 0, 0);
}, 30);   
</script>
</body>
</html>
